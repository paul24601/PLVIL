<!DOCTYPE html>
<html>

<head>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
  <script src="https://raw.githack.com/fcor/arjs-gestures/master/dist/gestures.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }

    a-scene {
      margin: 0;
    }
  </style>
</head>

<body>
  <a-scene embedded
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3_HAMMING63;"
    renderer="logarithmicDepthBuffer: true;" vr-mode-ui="enabled: false" gesture-detector id="scene">

    <a-sound id="sound1" src="assets/Intro to PLVIL.wav"></a-sound>
    <a-sound id="sound2" src="assets/Intro to AR.wav"></a-sound>
    <a-sound id="sound3" src="assets/Intro to Highlights.wav"></a-sound>
    <a-sound id="bgm" src="assets/bg-music.mp3"></a-sound>

    <a-assets>
      <video autoplay loop="true" id="plvil-vid" src="assets/vids/PLVIL.mp4"></video>
      <video loop="true" id="pio-vid" src="assets/vids/PIO.mp4"></video>
      <video autoplay loop="true" id="plvil-square" src="assets/vids/plvil-square.mp4"></video>
      <img id="image1" src="assets/slides/1.png">
      <img id="image2" src="assets/slides/2.png">
      <img id="image3" src="assets/slides/3.png">
      <img id="image4" src="assets/slides/4.png">
      <img id="image5" src="assets/slides/5.png">
      <a-asset-item id="3d-plvil" src="assets/PLVIL.glb"></a-asset-item>
      <a-asset-item id="3d-pio" src="assets/PIO.glb"></a-asset-item>
    </a-assets>

    <a-marker markerhandler="soundSrc: #sound1" type="barcode" value="0" raycaster="objects: .clickable"
      emitevents="true" cursor="fuse: false; rayOrigin: mouse;">

      <a-video id="marker-video" src="#plvil-vid" rotation="-90 0 0" width="10" height="5" position="-9 0 0"
      video-handler="volume: 0.05"></a-video>

      <a-video id="marker-video" src="#plvil-square" position="0 1 0" rotation="-90 0 0" width="6" height="6" video-handler="volume: 0"></a-video>

      <a-plane id="imagePlane" src="#image1" rotation="-90 0 0" height="5" width="10" position="9 0 0"
      class="clickable" slideshow-toggle1 gesture-handler></a-plane>

      <a-entity gltf-model="#3d-plvil" scale="7 7 7" rotation="0 0 0" position="0 1 -4.5"></a-entity>
    </a-marker>

    <a-marker markerhandler="soundSrc: #sound3" type="barcode" value="1" raycaster="objects: .clickable"
      emitevents="true" cursor="fuse: false; rayOrigin: mouse;">

      <a-video id="marker-video" src="#pio-vid" rotation="-90 0 0" width="10" height="5" position="-9 0 0"
      video-handler="volume: 0.05"></a-video>

      <a-video id="marker-video" src="#plvil-square" position="0 1 0" rotation="-90 0 0" width="6" height="6" video-handler="volume: 0"></a-video>

      <a-plane id="imagePlane" src="#image1" rotation="-90 0 0" height="5" width="10" position="9 0 0"
      class="clickable" slideshow-toggle2 gesture-handler></a-plane>

      <a-entity gltf-model="#3d-pio" scale="5 5 5" rotation="0 0 0" position="0 1 -4"></a-entity>
    </a-marker>

    <a-entity camera cursor="fuse: false; rayOrigin:mouse;"></a-entity>
  </a-scene>
  <script>
    // Marker handler component
    AFRAME.registerComponent('markerhandler', {
      schema: {
        soundSrc: { type: 'string' }
      },
      init: function () {
        this.soundEl = document.querySelector(this.data.soundSrc);

        this.el.addEventListener('markerFound', () => {
          this.soundEl.components.sound.playSound();
        });

        this.el.addEventListener('markerLost', () => {
          this.soundEl.components.sound.stopSound();
        });
      }
    });

    //Volume controller
    AFRAME.registerComponent('video-handler', {
      schema: {
        volume: { type: 'number', default: 1.0 }
      },
      init: function () {
        this.videoEl = document.querySelector(this.el.getAttribute('src'));
        this.videoEl.volume = this.data.volume;
      },
      tick: function () {
        if (!this.el.object3D.visible) {
          // If marker is not visible, stop the video
          this.videoEl.pause();
        } else if (this.videoEl.paused) {
          // If marker is visible and video is paused, play the video
          this.videoEl.play();
        }
      }
    });

    // Slideshow toggle
    AFRAME.registerComponent('slideshow-toggle1', {
      init: function () {
        var plane = this.el;
        var images = ['#image1', '#image4', '#image5', '#image2', '#image3'];
        var currentIndex = 0;

        plane.addEventListener('click', function () {
          currentIndex = (currentIndex + 1) % images.length;
          plane.setAttribute('src', images[currentIndex]);
        });
      }
    });

    // Slideshow toggle
    AFRAME.registerComponent('slideshow-toggle2', {
      init: function () {
        var plane = this.el;
        var images = ['#image1', '#image4', '#image5', '#image2', '#image3'];
        var currentIndex = 0;

        plane.addEventListener('click', function () {
          currentIndex = (currentIndex + 1) % images.length;
          plane.setAttribute('src', images[currentIndex]);
        });
      }
    });
  </script>
</body>

</html>